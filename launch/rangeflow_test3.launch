<!-- 
Example launch file: Kinect Visual Odometry using fovis 
-->

<launch>
  
	<param name="/use_sim_time" value="true"/>
 
	<arg name="localpath" default="/home/edward/catkin_ws/src/pcl_registration/"/>
	
	<!-- Play Rosbag file -->
	<node pkg="rosbag" type="play" name="rosbag" args="-r 1 -s 15
		$(arg localpath)/3_level02_ccw/kinect_ship_test3_1.bag
		$(arg localpath)/3_level02_ccw/kinect_ship_test3_2.bag 
		$(arg localpath)/3_level02_ccw/kinect_ship_test3_3.bag  --clock "/>
	

	<node pkg="ca_rangeflow" type="ca_rangeflow" name="ca_rangeflow" output="screen" >
	      <rosparam file="$(find ca_rangeflow)/config/param640.yaml" command="load"/>
	      <remap from="/camera/depth/image_rect" to="/camera/depth_registered/image" />
	      <remap from="/camera/depth/camera_info" to="/camera/depth_registered/camera_info" />
	</node>
	

	
	
	######## camera_init frame is: X forward, Z upward ##########    
	<node pkg="tf" type="static_transform_publisher" name="odomtoinit"
	      args="0    0    0    1.57     0    1.4  /odom_frame /camera_init 100"/>
	    
	<node pkg="tf" type="static_transform_publisher" name="cameratobase" 
	      args="0    0    0    -1.57     -1.4    0  /camera /base_frame 100" />

	<node pkg="tf" type="static_transform_publisher" name="basetocamera" 
	      args="0    0    0    1.57  0.0  1.57  /camera /camera_rgb_optical_frame 100" />
	      
	      
	<node pkg="hector_trajectory_server" type="hector_trajectory_server" name="localization_path" output="screen">
		<param name="target_frame_name" type="string" value="/map" />
		<param name="source_frame_name" type="string" value="/base_frame" />
		<param name="trajectory_update_rate" type="double" value="10" />
		<param name="trajectory_publish_rate" type="double" value="10" />
	</node>
   	
   	
   	
   	
  	<node pkg="odom_tf_utils" type="odom_tf_utils_tf_to_odom" name="tf_odom" >
	    <param name="source_frame" type="string" value="/map" />
	    <param name="target_frame" type="string" value="/base_frame" />
	    <remap from="odom" to="rangeflow_odom" />
	</node>

	<!--<node pkg="rviz" type="rviz" name="rviz" args="-d $(find ca_rangeflow)/launch/odom.rviz"/>-->
	
	<!--<node pkg="tf" type="static_transform_publisher" name="actualmap_to_cloudmap"-->
	      <!--args="0  0  0  1.57  3.14  0 /map /odom_frame  100"  />-->

	<node pkg="tf" type="static_transform_publisher" name="actualmap_to_cloudmap"
		  args="0.1  0.7  0  1.5  3.04  0.0 /map /odom_frame  100"  />

	 <!--Show actual map in rviz-->
	<!--<node pkg="map_server" type="map_server" name="actual_map" args="$(find ca_rangeflow)/mapfiles/level2.yaml" />-->

	<node pkg="rviz" type="rviz" name="rviz" args="-d $(find ca_rangeflow)/config/icp.rviz"/>
	<node pkg="map_server" type="map_server" name="actual_map" args="$(find ca_depth_odometry)/mapfiles/level2.yaml" />

</launch>
